# ScheduleMaster 日历编辑器功能分析

> **分析日期**: 2026-01-09
> **分析范围**: 日历核心功能、用户体验、性能优化、缺失功能

---

## ✅ 已实现的核心功能

| 功能 | 实现方式 |
|------|----------|
| 周视图/日视图 | `WeeklyCalendar.tsx`, `DailyCalendar.tsx` |
| 拖拽创建事件 | `useDragToCreate` hook |
| 拖拽移动事件 | `useEventDrag` hook |
| 事件编辑/删除 | `EditEventDialog`, `EventContextMenu` |
| 事件重叠处理 | `groupOverlappingEvents` 算法 |
| 响应式设计 | `useIsMobile` hook |
| 事件样式 | 8种颜色 + 图标 + 优先级 |
| 设置系统 | 周开始日、12/24小时制、时间增量 |
| Google Calendar 同步 | Pro 功能 |

---

## 🔴 做得不好的功能

### 1. 重复事件完全缺失
这是最严重的功能缺失。用户无法创建：
- 每日/每周/每月重复事件
- 自定义重复规则（如"每周一、三、五"）
- 重复事件的例外处理

### 2. 多日事件支持不完善
- 创建多日事件时，每个日期都创建独立的事件记录
- 没有真正的"跨天事件"概念
- 编辑时无法批量修改所有实例

### 3. 任务模式混乱
- 全局开关控制，无法单独设置某个事件为任务
- 复选框完成状态缺乏持久化机制
- 任务和事件混在一起，缺乏清晰的区分

### 4. 事件模板功能简陋
- API 有 `/api/schedules/templates`，但前端交互不明显
- 缺少模板分类和管理
- 无快速应用模板的入口

---

## 🟡 需要优化的功能

### 1. 性能优化
```typescript
// 问题：大量事件时重叠计算是 O(n²)
// 建议：使用更高效的算法或虚拟滚动
```

### 2. 拖拽体验

| 问题 | 建议 |
|------|------|
| 移动端拖拽时无明显的视觉反馈 | 添加拖拽时的半透明遮罩效果 |
| 时间吸附不够精确 | 改进吸附算法，增加磁吸动画 |
| 拖拽创建后的表单弹窗打断流程 | 改为内联编辑或侧边栏 |

### 3. 错误处理
- API 失败时只打印 `console.error`
- 需要使用 `sonner` toast 给用户友好提示
- 网络冲突时缺少乐观更新的回滚机制

### 4. 移动端交互
- `MobileEventActionSheet` 底部菜单可以更流畅
- 缺少移动端常见的手势操作（长按、双击）
- 触摸目标尺寸在某些区域偏小

### 5. 时间编辑体验
```typescript
// EventForm.tsx 中的时间选择器体验一般
// 建议：使用更直观的时间选择组件
```

---

## 🟢 缺失的功能建议

### 高优先级（核心体验）

#### 1. 重复/周期性事件 ⭐⭐⭐
- 每日/每周/每月/每年重复
- 工作日重复
- 自定义重复规则
- 重复结束条件（日期/次数）

#### 2. 事件提醒/通知 ⭐⭐⭐
- 提前 5/10/15/30/60 分钟提醒
- 邮件/浏览器通知
- 多个提醒点

#### 3. 多日事件正确显示 ⭐⭐⭐
- 跨天事件在周视图横跨多列显示
- 而不是每天显示一个独立块

#### 4. 事件搜索和筛选 ⭐⭐
- 按标题/描述搜索
- 按颜色/类型筛选
- 按时间范围筛选

### 中优先级（增强体验）

#### 5. 事件标签/分类系统
- 自定义标签
- 多标签支持
- 标签颜色自定义

#### 6. 事件附件
- 关联文件/链接
- 会议链接（Zoom/Teams等）
- 位置信息

#### 7. 事件分享/协作
- 生成分享链接
- 邀请参与者
- 参与者 RSVP

#### 8. 撤销/重做功能
- 操作历史栈
- Ctrl+Z 支持

### 低优先级（锦上添花）

#### 9. 日视图的时间轴优化
- 更平滑的滚动
- 跳转到当前时间按钮

#### 10. 事件拖拽复制
- 按住 Ctrl 拖拽复制事件
- 快速创建类似事件

#### 11. 事件统计
- 每日/周/月事件统计
- 时间分配分析

#### 12. 导入/导出
- CSV 导入导出
- iCalendar (.ics) 格式支持

---

## 📊 总结

| 类别 | 数量 | 优先处理 |
|------|------|----------|
| 做得不好的功能 | 4 | 重复事件、任务模式 |
| 需要优化的功能 | 5 | 性能、拖拽体验 |
| 缺失的功能 | 12 | 重复事件、提醒、多日事件 |

---

## 🎯 建议优先级顺序

1. **重复事件功能** - 影响最大
2. **多日事件正确显示**
3. **事件提醒功能**
4. **性能优化**（虚拟滚动）
5. **搜索和筛选**

---

## 📁 相关文件

```
components/
├── calendar/
│   ├── WeeklyCalendar.tsx    # 周视图
│   └── DailyCalendar.tsx     # 日视图
├── AddEventDialog.tsx        # 添加事件对话框
├── EditEventDialog.tsx       # 编辑事件对话框
└── EventForm.tsx             # 事件表单

hooks/
├── useEventDrag.ts           # 拖拽事件
├── useDragToCreate.ts        # 拖拽创建
└── useMediaQuery.ts          # 响应式检测

lib/
├── types.ts                  # 类型定义
└── event-display-utils.ts    # 显示工具
```

---

**文档版本**: 1.0
